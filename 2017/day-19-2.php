<?php

$input = '     |
     |  +--+
     A  |  C
 F---|----E|--+
     |  |  |  D
     +B-+  +--+';

$input = '                                       |
 +-----+         +-----+ +-----+ +-----|-----+   +-+           +-----------------------------------------------------------------------------------------+ +---------+       +-+               +-+
 |     |         |     | |     | |     |     |   | |           |                                                                                         | |         |       | |               | |
 |     | +-------+ +---+ |     +-------------|---+ +---------------------+ +-----------------------------------------------------------------------------|-----------|---------------+         +-|---+
 |     | |         |     |       |     |     |                 |         | |                                                                             | |         |       | |     |           |   |
 |   +---|-------+ +-----|---+ +-------------|---+             |         | |                                           +-----Q                   +-------|-|-----+   |     +-|-|-------+         |   |
 |   | | |       |       |   | | |     |     |   |             |         | |                                           |                         |       | |     |   |     | | |     | |         |   |
 |   | | |       |   +---------|-|-----------|-------+         |         +-----------------------------+               +-----+                   |       | |     +-----+   | | |     | |         |   |
 |   | | |       |   |   |   | | |     |     |   |   |         |           |                           |                     |                   |       | |         | |   | | |     | |         |   |
 |   | | |       |   |   |   | +-+ +---------|---+   |       +-+ +-----------------------------------------------------------|-------------------|-------|-----------|-----+ | |     | | +-------|-----+
 |   | | |       |   |   |   |     |   |     |       |       |   |         |                           |                     |                   |       | |         | |     | |     | | |       |   | |
 |   | | |       |   +---|---|-+   |   |     |       |       |   |         |                 +---------------------------------+                 |     +-------------|-|-------------+ | |       | +-+ |
 |   | | |       |       |   | |   |   |     |       |       |   |         |                 |         |                     | |                 |     | | |         | |     | |       | |       | |   |
 |   +---+       |       |   | +---|-------------+   |       |   |         |           +-----|---------|---------------------|-|-----------------|-----|-|---+   +-------------|-----------------|-|-+ |
 |     |         |       |   |     |   |     |   |   |       |   |         |           |     |         |                     | |                 |     | | | |   |   | |     | |       | |       | | | |
 |     |         |       |   +---------|-------+ |   |       | +-----------------------------|-------------------------------|-+                 |     | +---+   |   | +---+ | | +---------------|-|-+ |
 |     |         |       |         |   |     | | |   |       | | |         |           |     |         |                     |                   |     |   |     |   |     | | | |     | |       | |   |
 |     |         |       |         |   |     | | |   |       | +-----------------------|-+   |     +-------------------------|-------------------------|---|---------|-----+ | | |     | |       | |   |
 |     |         |       |         |   |     | | |   |       |   |         |           | |   |     |   |                     |                   |     |   |     |   |       | | |     | |       | |   |
 |     |     +-----------|-------------|-----|-|-------------|---+         |           | +---|-----------------------+       +-------------+     |     |   |     |   |       | | |     | |       | | +-+
 |     |     |   |       |         |   |     | | |   |       |             |           |     |     |   |             |                     |     |     |   |     |   |       | | |     | |       | | |
 |     |     |   |       |   +---------|-----|-|-+   |       +-------------------------------|---------------------------------------------------|-------------------|---------|-|-------+       | | |
 |     |     |   |       |   |     |   |     | |     |                     |           |     |     |   |             |                     |     |     |   |     |   |       | | |     |         | | |
 |     |     +---+   +-------|---------------+ | +---|---------------------------------|-----|-+   |   |             |                     | +---|-----+   |     |   |       | | |     |         | | |
 |     |             |   |   |     |   |       | |   |                     |           |     | |   |   |             |                     | |   |         |     |   |       | | |     |         | | |
 |     |       +-----+   |   | +-------|-------|---+ | +-------------------|-----------|-----|-|---|---------------------------------------|-|-------------------|---|-------|-|-----------------+ | |
 |     |       |         |   | |   |   |       | | | | |                   |           |     | |   |   |             |                     | |   |         |     |   |       | | |     |           | |
 | +-------------------------|---------|-----------|-----------------------------------|-----|-|---|---|-------------------------------------+   |         |     |   |       | | |     |           | |
 | |   |       |         |   | |   |   |       | | | | |                   |           |     | |   |   |             |                     |     |         |     |   |       | | |     |           | |
 | |   |       +-+   +-------|---------------+ | | | | |                   |           |     | |   +-+ |             |             +-----------------------|-----------------|---------|-+         | |
 | |   |         |   |   |   | |   |   |     | | | | | |                   |           |     | |     | |             |             |       |     |         |     |   |       | | |     | |         | |
 | +---|-+     +-+   |   |   | | +-|-----+   | | +-|-+ |                   |           |     | |     | |             |             |       |     |         |     |   |       | | |     | |         | |
 |     | |     |     |   |   | | | |   | |   | |   |   |                   |           |     | |     | |             |             |       |     |         |     |   |       | | |     | |         | |
 |     | |     +-----|-------|-----|---|-|---|-|---------------------------------------------|-|-----------------------------------|-------|-------------------------+       | | |     +-+         | |
 |     | |           |   |   | | | |   | |   | |   |   |                   |           |     | |     | |             |             |       |     G         |     |           | | |                 | |
 |     | |     +-----|-+ | +-|-|---------|---|-----|---|-------------------------------|-------------|-|-----+       |     +---------------------|-----------------------------|-|-----------------+ |
 |     | |     |     | | | | | | | |   | |   | |   |   |                   |           |     | |     | |     |       |     |       |       |     |         |     |           | | |                   |
 |     | |     | +-----|-|-|-----|-|---------------|-----------------------------------------|-------|---------------------|---------------------|---------|---------------+ | | |                   |
 |     | |     | |   | | | | | | | |   | |   | |   |   |                   |           |     | |     | |     |       |     |       |       |     |         |     |         | | | |                   |
 | +-------------------|-----|-|---------+   | |   |   | +-----------------------------|-----|-|-----|---------------------|---------------|---------------|-----|---------|-|-|-|-----+             |
 | |   | |     | |   | | | | | | | |   |     | |   |   | |                 |           |     | |     | |     |       |     |       |       |     |         |     |         | | | |     |             |
 | |   | |     | |   | | +---+ | +---------------------|-|---------------+ |           |     | |     | |     |       +-----|---------+     |     |       +-|-----|-----+   | | | |     |             |
 | |   | |     | |   | |   |   |   |   |     | |   |   | |               | |           |     | |     | |     |             |       | |     |     |       | |     |     |   | | | |     |             |
 | |   | |     | |   | |   |   |   |   |     | |   |   | |               | |           | +---|-|-------|-----|-------------|-------|-------------+   +-+ | +-----|---------+ | | |     |             |
 | |   | |     | |   | |   |   |   |   |     | |   |   | |               | |           | |   | |     | |     |             |       | |     |         | | |       |     |     | | |     |             |
 | |   | |     | |   | |   |   |   | +-------|---------|-|---------------|-------------+ |   | |     | |     |     +-------|-------------+ +---------+ | |       |     |     +-------+ |             |
 | |   | |     | |   | |   |   |   | | |     | |   |   | |               | |             |   | |     | |     |     |       |       | |   |             | |       |     |       | |   | |             |
 | |   | |     | |   | |   |   |   | | |     | |   |   | |               | |             |   | |     | |     |     |       |     +-----------------------|-------|-----+       | |   | |             |
 | |   | |     | |   | |   |   |   | | |     | |   |   | |               | |             |   | |     | |     |     |       |     | | |   |             | |       |             | |   | |             |
 | |   | |     | |   | |   |   | +---+ |     | |   |   | |               | | +-----------|-----------|-----+ |     |       |     +---|---|-------------|-|------------------P----|-+ | |             |
 | |   | |     | |   | |   |   | | |   |     | |   |   | |               | | |           |   | |     | |   | |     |       |       | |   |             | |       |             | | | | |             |
 | |   | |     | |   | |   |   | | |   |     | |   |   | |               | | |           |   | |     | |   | |     |     +-+       | |   | +---+       | |       |             | | | | |             |
 | |   | |     | |   | |   |   | | |   |     | |   |   | |               | | |           |   | |     | |   | |     |     |         | |   | |   |       | |       |             | | | | |             |
 | |   | |     | |   | | +-------------------|-|-----------------------+ | | |           |   | |     | |   | |     |     |         | |   | |   |       | |       |             | | | | |             |
 | |   | |     | |   | | | |   | | |   |     | |   |   | |             | | | |           |   | |     | |   | |     |     |         | |   | |   |       | |       |             | | | | |             |
 | | +---|-----|-------|-|-|-----|-+   |     | |   | +---|-------------------------------|---+ |     | |   | |     |     |         | |   | |   |       | | +---------------------|-----|---+         |
 | | | | |     | |   | | | |   | |     |     | |   | | | |             | | | |           |     |     | |   | |     |     |         | |   | |   |       | | |     |             | | | | |   |         |
 | | | | |     | +-------------|-|-----------|-|-----|-----------------|---|-|-----------|-----------|-+   | |     |     |         | +---|-----|-----------------------+       | | | | |   |         |
 | | | | |     |     | | | |   | |     |     | |   | | | |             | | | |           |     |     |     | |     |     |         |     | |   |       | | |     |     |       | | | | |   |         |
 | | | | |     |     | | | |   | |     |     | |   | | | |             | | | |           |     |     |     | |     |     |         |     | |   |       | | |     |     |       | | | | |   |         |
 | | | | |     |     | | | |   | |     |     | |   | | | |             | | | |           |     |     |     | |     |     |         |     | |   |       | | |     |     |       | | | | |   |         |
 | | | | |     |     | | | |   | |     |     | +---+ | | |             | | | |           |     |     |     | |     |     |         |     | | +-|-------|-|-|-----|-------------|-----+ |   | +---+   |
 | | | | |     |     | | | |   | |     |     |       | | |             | | | |           |     |     |     | |     |     |         |     | | | |       | | |     |     |       | | |   |   | |   |   |
 | | | | |     |     | | | |   | |     |     |       | | |       +-----|-|---|-----------|-----|-------+   | |     |     |         |     | | | |       | | |     |     |       | | |   |   | |   |   |
 | | | | |     |     | | | |   | |     |     |       | | |       |     | | | |           |     |     | |   | |     |     |         |     | | | |       | | |     |     |       | | |   |   | |   |   |
 | | | | |     |     | | | |   | |     |     |       | | |       |     | | | |       +-+ |     |   +-|-+   | |     |     |         |     | | | |       | | |     |     |   +---|---|---|---|-|---|-+ |
 | | | | |     |     | | | |   | |     |     |       | | |       |     | | | |       | | |     |   | |     | |     |     |         |     | | | |       | | |     |     |   |   | | |   |   | |   | | |
 | | | | |     |     | | | |   | |     |     |       | | |       |     | | | |       | | |     |   | |     | |     |     |         |     | | | |       | | |     |     |   |   | | |   |   | |   | | |
 | | | | |     |     | | | |   | |     |     |       | | |       |     | | | |       | | |     |   | |     | |     |     |         |     | | | |       | | |     |     |   |   | | |   |   | |   | | R
 | | | +-------|-----|-|-|-|-----|-----|---------------|-----------------|-|-------------------|---|---------|-----------|-------------------|-----+   | | |     |     |   |   | | |   |   | |   | | |
 | | |   |     |     | | | |   | |     |     |       | | |       |     | | | |       | | |     |   | |     | |     |     |         |     | | | |   |   | | |     |     |   |   | | |   |   | |   | | |
 | | |   |     |     | | | |   | |     |     |       | | |       |     | | | |       | | |     |   | |     | |     |     |         |     | | | |   |   | | |     |     |   |   | | |   | +---|---|---|-+
 | | |   |     |     | | | |   | |     |     |       | | |       |     | | | |       | | |     |   | |     | |     |     |         |     | | | |   |   | | |     |     |   |   | | |   | | | |   | | | |
 | | |   |     |     | | | |   | |     |     |       | | |       |     | | | |       | | |     |   | |     | |     |     |         |     | | | |   |   | | |     |     |   |   | | |   | | | |   | | | |
 | | |   |     |     | | | |   | |     |     |       | | |       |     | | | |       | | |     |   | |     | |     |     |         |     | | | |   |   | | |     |     |   |   | | |   | | | |   | | | |
 | | +-----------+   | | | |   | |     |     |       | | |       |     | | | |       | | |     |   | |     | |     |     |         |     | | | |   | +-----------|---------+   | | |   | | | |   | | | |
 | |     |     | |   | | | |   | |     |     |       | | |       |     | | | |       | | |     |   | |     | |     |     |         |     | | | |   | | | | |     |     |       | | |   | | | |   | | | |
 | |     |     | |   | | | |   | |     |   +-|---------|-|---------------|-----------|---+     |   | |     | |     |     |         |     | | | |   | | | | |     |     |       | | |   | | | |   | | | |
 | |     |     | |   | | | |   | |     |   | |       | | |       |     | | | |       | |       |   | |     | |     |     |         |     | | | |   | | | | |     |     |       | | |   | | | |   | | | |
 | |     |     | | +-|-----|-----|---------|-----------|---------------|-|-----------|---------------+ +---|-----------------------|-----|-|-|-|-----|-----|---+ |     |       | | |   | | | |   | | | |
 | |     |     | | | | | | |   | |     |   | |       | | |       |     | | | |       | |       |   |   |   | |     |     |         |     | | | |   | | | | |   | |     |       | | |   | | | |   | | | |
 | |     |     | | | | | | | +-|-----+ |   | |       | | |       |     | | | |       | |       |   |   |   | |     |     |         |     | | | |   | | | | |   | |     |       | | |   | | | |   | | | |
 | |     |     | | | | | | | | | |   | |   | |       | | |       |     | | | |       | |       |   |   |   | |     |     |         |     | | | |   | | | | |   | |     |       | | |   | | | |   | | | |
 | |     |     | | | | | | | | | |   | |   | |       | | |       |     | | | |       | |       |   |   |   | |     |     |         |     | | | |   | +---|-|-----+     |       | | |   | | | |   | | | |
 | |     |     | | | | | | | | | |   | |   | |       | | |       |     | | | |       | |       |   |   |   | |     |     |         |     | | | |   |   | | |   |       |       | | |   | | | |   | | | |
 | |     |     | | | | | | | | | |   | |   | |       | | |       |     | | | |       | |       |   |   |   | |     |     |         |     | | | |   |   | | |   |       |       | | |   | | | |   | | | |
 | |     |     | | | | | | | | | |   | |   | |       | | |       |     | | | |       | |       |   |   |   | |     |     |         |     | | | |   |   | | |   |       |       | | |   | | | |   | | | |
 | |     |     | | | | | | | | +-------|---|---------|---|-------|-----|-|-|-------------------|---|-------+ |     |     |         |     | | | |   |   | | |   |       |     +-|-------|-|---|-+ | | | |
 | |     |     | | | | | | | |   |   | |   | |       | | |       |     | | | |       | |       |   |   |     |     |     |         |     | | | |   |   | | |   |       |     | | | |   | | | | | | | | |
 | |     |     | | | | | | | |   | +-|-|---+ |       | | |       |     | | | |       | |       |   |   |     |     |     |         |     | | | |   |   | | |   |       |     +-|-|---+ | | | | | | | | |
 | |     |     | | | | | | | |   | | | |     |       | | |       |     | | | |       | |       |   |   |     |     |     |         |     | | | |   |   | | |   |       |       | | | | | | | | | | | | |
 | | +---|-----|-|-----|-|-----------|---------------+ | |       |     | | | |       | |       |   |   |     +-----------|-----------------|-|-|---|---|-|-----------+ |       | | | | | | | | | | | | |
 | | |   |     | | | | | | | |   | | | |     |         | |       |     | | | |       | |       |   E   |           |     |         |     | | | |   |   | | |   |     | |       | | | | | | | | | | | | |
 | | |   |     | | | | | | | |   | | +-|-----|---------|-|-------------|-|-------------|-------|---|-------+       |     | +-------|-+   | | | |   |   | | |   | +---|-|-----+ | | | | | | | | | | | | |
 | | |   |     | | | | | | | |   | |   |     |         | |       |     | | | |       | |       |   |   |   |       |     | |       | |   | | | |   |   | | |   | |   | |     | | | | | | | | | | | | | |
 | | |   |     | | | | | | | |   | |   |     |         | |       |     | | | |       | |       |   |   |   |       |     | |       | |   | | | |   |   | | |   | |   | |     | | | | | | | | | | | | | |
 | | |   |     | | | | | | | |   | |   |     |         | |       |     | | | |       | |       |   |   |   |       |     | |       | |   | | | |   |   | | |   | |   | |     | | | | | | | | | | | | | |
 | | |   |     | | | | | | | |   | |   +---------------|-|-------|---+ | | | |       | |       |   |   |   |       |     | |       | | +---|-|-|---|-----|-|-----|---|-----------------|-|-|-|-|-|-+ | |
 | | |   |     | | | | | | | |   | |         |         | |       |   | | | | |       | |       |   |   |   |       |     | |       | | | | | | |   |   | | |   | |   | |     | | | | | | | | | | |   | |
 | | |   |     | | | | | | | |   +-|---------|---------|-|-------|---|-|---------------|-------|---|---------------|-----+ |       | | | | | | |   |   | | |   +-|-+ | |     | | | | | | | | | | |   | |
 | | |   |     | | | | | | | |     |         |         | |       |   | | | | |       | |       |   |   |   |       |       |       | | | | | | |   |   | | |     | | | |     | | | | | | | | | | |   | |
 | | |   | +---|-|-|---------------+ +-------|-+       | |       |   | | | | |       | | +-----|---|---------------|-----+ |       | | | | | | |   +---------+   | | | |     | | | | | | | | | | |   | |
 | | |   | |   | | | | | | | |       |       | |       | |       |   | | | | |       | | |     |   |   |   |       |     | |       | | | | | | |       | | | |   | | | |     | | | | | | | | | | |   | |
 | | |   | |   | | | | | | | |       |       | |       | |       |   | | | | |       | | |     |   |   |   |       |     | |       | | | | | | |     +---|---|-+ | | | |     | | | | | | | | | | |   | |
 | | |   | |   | | | | | | | |       |       | |       | |       |   | | | | |       | | |     |   |   |   |       |     | |       | | | | | | |     | | | | | | | | | |     | | | | | | | | | | |   | |
 | | |   | |   | | | | | | | |       |       | |       | |       | +---|---------------|-----------|---|-------------------|-------|-|-|-------------|---|-+ | | | | | |     | | | | | | | | | | |   | |
 | | |   | |   | | | | | | | |       |       | |       | |       | | | | | | |       | | |     |   |   |   |       |     | |       | | | | | | |     | | |   | | | | | |     | | | | | | | | | | |   | |
 | | | +-|-|---|-|-|-|-|-----|-----------------|---------|-------|---|-|---|---------|---------|---|---+   |       |     | |       | | | | | | |     | | |   | | | | | |     | | | | | | | | | | |   | |
 | | | | | |   | | | | | | | |       |       | |       | |       | | | | | | |       | | |     |   |       |       |     | |       | | | | | | |     | | |   | | | | | |     | | | | | | | | | | |   | |
 | | | +---+   | | | | | | | |       |       | |       | +-------|---|-|-------------|---|-------------------------|-----|-|-------|-|---|-|---|-------|---------|---+ |     | | | | | | | | | | |   | |
 | | |   |     | | | | | | | |       |       | |       |         | | | | | | |       | | |     |   |       |       |     | |       | | | | | | |     | | |   | | | |   |     | | | | | | | | | | |   | |
 | | |   |     | | | | | | | |       |       | |       |         | | | | | | |       | | |     |   |       |       |     | |       +-|-|-|-----|----V|-|---+ | | | |   |     | | | | | | | | | | |   | |
 | | |   |     | | | | | | | |       |       | |       |         | | | | | | |       | | |     |   |       |       |     | |         | | | | | |     | | | | | | | |   |     | | | | | | | | | | |   | |
 | | |   |     | | | | | | | |       |       | |       |         | | | | | | |       | | |     |   |       |       |     | |         | | | | | |     | | | | | | | |   |     | | | | | | | | | | |   | |
 | | |   |     | | | | | | | |       |       | |       |         | | | | | | |       | | |     |   |       |       |     | |         | | | | | |     | | | | | | | |   |     | | | | | | | | | | |   | |
 | | |   |     | | | | | | | |       |       | |       |         | | +-|---|---------|-----+   |   |       |       |     | |         | | | | | |     | | | | | | | |   |     | | | | | | | | | | |   | |
 | | |   |     | | | | | | | |       |       | |       |         | |   | | | |       | | | |   |   |       |       |     | |         | | | | | |     | | | | | | | |   |     | | | | | | | | | | |   | |
 | | |   |     | | | | | | | |       |       | |       |         | |   | +-|-|-------------|---|-----------|-----------------------------|-|-------+ | +-|---|-+ | |   |     | | +---|-|-------|---+ | |
 | | |   |     | | | | | | | |       |       | |       |         | |   |   | |       | | | |   |   |       |       |     | |         | | | | | |   | |   | | |   | |   |     | |   | | | | | | | | | | |
 | | |   |     | | | | | | | |       |       | |       |         | |   |   | |       | | | |   |   |       |       |     | |         | | | | | |   | |   | | |   | |   |     | |   | | | | | | | | | | |
 | | |   |     | | | | | | | |       |       | |       |         | |   |   | |       | | | |   |   |       |       |     | |         | | | | | |   | |   | | |   | |   |     | |   | | | | | | | | | | |
 | | |   |     | | | | | | | |       |       | |       | +-------|-|---|---|-|-------|---|---------|-------|-------|-----------------|---------|---|-+   | | |   | |   |     | |   | | | | | | | | | | |
 | | |   |     | | | | | | | |       |       | |       | |       | |   |   | |       | | | |   |   |       |       |     | |         | | | | | |   |     | | |   | |   |     | |   | | | | | | | | | | |
 | | |   |     | | | | | | | |       |       | |       | |       | |   | +---|-----------|---------+       |       |     | |         | | | | | |   |     | | |   | |   |     | |   | | | | | | | | | | |
 | | |   |     | | | | | | | |       |       | |       | |       | |   | | | |       | | | |   |           |       |     | |         | | | | | |   |     | | |   | |   |     | |   | | | | | | | | | | |
 | | |   |     | | | | | | | |       |       | |       | |       | |   | | | |       | | | |   |           |       |     | |         | | | | | |   |     | | |   | |   |     | |   | | | | | | | | | | |
 | | |   |     | | | | | | | |       |       | |       | |       | |   | | | |       | | | |   |           |       |     | |         | | | | | |   |     | | |   | |   |     | |   | | | | | | | | | | |
 | +-------------------|-|-|-----------------|-|-------|-|-------|-|---|-|-|---------|---------|-----------|-------|-----------------|-|-|-----------------|-|---|-----------|-|-----|---|---|-|-+ | | |
 |   |   |     | | | | | | | |       |       | |       | |       | |   | | | |       | | | |   |           |       |     | |         | | | | | |   |     | | |   | |   |     | |   | | | | | | |   | | |
 |   |   |     | | | | | | | |   +-----------|---------+ |       | |   | | | +-----------|-|---------------|-------|-----+ |         | | | | | |   |     | | |   | |   |     | |   | | | | | | |   | | |
 |   |   |     | | | | | | | |   |   |       | |         |       | |   | | |         | | | |   |           |       |       |         | | | | | |   |     | | |   | |   |     | |   | | | | | | |   | | |
 |   |   |   +-------|-|-+ | |   | +-+       | |         |       | |   | | |         | | | |   |           |       |       |         | | | | | |   |     | | |   | |   |     | |   | | | | | | |   | | |
 |   |   |   | | | | | |   | |   | |         | |         |       | |   | | |         | | | |   |           |       |       |         | | | | | |   |     | | |   | |   |     | |   | | | | | | |   | | |
 |   |   |   | | | | | |   | |   | |         | |         |       | |   | | |         | | | |   |           |       |       |         | | | | | |   |     | | |   | |   |     | |   | | | | | | |   | | |
 |   |   |   | | | | | |   | |   | |         | |         |       | |   | | |         | | | |   |           |       |       |         | | | | | |   |     | | |   | |   |     | |   | | | | | | |   | | |
 |   |   |   | | | | | |   | |   | |         | |         |       | |   | | |         | | | |   |           |   +---|-+     |         | +-|-|---|---|---------------|---------------|-----+ | | |   | | |
 |   |   |   | | | | | |   | |   | |         | |         |       | |   | | |         | | | |   |           |   |   | |     |         |   | | | |   |     | | |   | |   |     | |   | | |   | | |   | | |
 |   |   |   | | | | | |   | |   | |         | |       +---------|-|---|---|---------------|---|---------------|---|-+     |         |   | | | |   |     | +-|---|-|-----------|---|-|-----------+ | | |
 |   |   |   | | | | | |   | |   | |         | |       | |       | |   | | |         | | | |   |           |   |   |       |         |   | | | |   |     |   |   | |   |     | |   | | |   | | | | | | |
 +---------------------|-----|-----------------|-------|-|---------|-------|-----------|-|-|---|-----------|A--|-------------------------|-|-|-|---------|-------|-----|-----|-----|---+   | | +-|-----+
     |   |   | | | | | |   | |   | |         | |       | |       | |   | | |         | | | |   |           |   |   |       |         |   | | | |   |     |   |   | |   |     | |   | |     | |   | | |
 +---|----M--|-|---|---|---|-------|---------|-----------|-------|-----+ | |         | | | |   |           |   |   |       |         |   | | | +---|---------------|---------|-|---|-|-----|-----+ | |
 |   |   |   | | | | | |   | |   | |         | |       | |       | |     | |         | | | |   |           |   |   |       |         |   | | |     |     |   |   | |   |     | |   | |     | |     | |
 +---+   | +-|-|-|-|-|-|-----------|-----------|-------|-|---------------|-----------|-----|---|-----------|---|---|-------|---------|---|---------------|---|---|-----|-----|-----|-|-----|-|-------|-+
         | | | | | | | |   | |   | |         | |       | |       | |     | |         | | | |   |           |   |   |       |         |   | | |     |     |   |   | |   |     | |   | |     | |     | | |
         | | | | | | | |   | |   | |         | |       | |       | |     | |         | | | |   |           |   |   |       |         |   | | |     |     |   |   | |   |     | |   | |     | |   +-+ | |
         | | | | | | | |   | |   | |         | |       | |       | |     | |         | | | |   |           |   |   |       |         |   | | |     |     |   |   | |   |     | |   | |     | |   |   | |
         | | | | | | | |   | |   | |         | |       | |       | |     | |         | | | |   |           |   |   |       |         |   | | |     |     |   |   | |   |     | |   | |     | |   |   | |
         | | | | | | | |   | |   | |         | |       | |       | |     | |         | | | |   |           |   |   |       |         |   | | |     |     |   |   | |   |     | |   | |     | |   |   | |
         | | | | | | | +-----|-----------------|-----------------|-------------------|-|-|-|---------------|---------------------------------------|---------|-----|-----------|---+ |     | |   |   | |
         | | | | | | |     | |   | |         | |       | |       | |     | |         | | | |   |           |   |   |       |         |   | | |     |     |   |   | |   |     | |     |     | |   |   | |
         | | | | | | |     | |   +-|---------|---------|---------------------------------|-----|-------------------------------------+ +---|-|-----+   +-|---|---------|-----|---------------|---+   | |
         | | | | | | |     | |     |         | |       | |       | |     | |         | | | |   |           |   |   |       |           | | | |         | |   |   | |   |     | |     |     | |       | |
         | | | | | | |     | |     |         | |       | |       | |     | |         | | | |   |           |   |   |       |           | | | |         | |   |   | |   |     | |     |     | |       | |
         | | | | | | |     | |     |         | |       | |       | |     | |         | | | |   |           |   |   |       |           | | | |         | |   |   | |   |     | |     |     | |       | |
         | | | | | +-|-----|-------+         | |       | +-------|---------|-----------|-----------------------|-----------------------------|---------|-----|---|-|---------|-|-----|---------------|-+
         | | | | |   |     | |               | |       |         | |     | |         | | | |   |           |   |   |       |           | | | |         | |   |   | |   |     | |     |     | |       |
         | | | | |   |     | |               | |       |         | |   +-+ |         | | | |   |           |   |   |       |           | | | |         | |   |   | |   |     | |     |     | |       |
         | | | | |   |     | |               | |       |         | |   |   |         | | | |   |           |   |   |       |           | | | |         | |   |   | |   |     | |     |     | |       |
         | | | | |   +-----|----Y------------------+   |         | |   |   |         | | | |   |           |   +-------------+         | | | |         | |   | +-|-+   |     | |     |     | |       |
         | | | | |         | |               | |   |   |         | |   |   |         | | | |   |           |       |       | |         | | | |         | |   | | |     |     | |     |     | |       |
         | | | | |         | |               +-|---|-------------|---+ |   |         | | | |   |           |       |       | +---------|-----------------|-----+ |     |     | |     |     | |       |
         | | | | |         | |                 |   |   |         | | | |   |         | | | |   |           |       |       |           | | | |         | |   |   |     |     | |     |     | |       |
         | | | | |         | |     +-----------|---|-----------------|-|-------------|-|-|-|---|-----------|-------|-------+           | | | |         | |   |   |     |     | |     |     | |       |
         | | | | |         | |     |           |   |   |         | | | |   |         | | | |   |           |       |                   | | | |         | |   |   |     |     | |     |     | |       |
         | | | | |         | |     |           |   |   |         | +---|---|-------------------|-----------|-------|-------------------|-|---|-----------|-------|-------------------|-------|-------|-+
         | | | | |         | |     |           |   |   |         |   | |   |         | | | |   |           |       |                   | | | |         | |   |   |     |     | |     |     | |       | |
         | | | +-------------------+           |   |   |         |   | |   |         | | | |   |           |       |                   | | | |         | |   |   |     |     | |     |     | |       | |
         | | |   |         | |                 |   |   |         |   | |   |         | | | |   |           |       |                   | | | |         | |   |   |     |     | |     |     | |       | |
         | | |   |   +-------|-----+           |   |   |         +---|-----------------|-|-----+           |       +-+                 | | | |         | |   |   |     |     | |     +---+ | |       | |
         | | |   |   |     | |     |           |   |   |             | |   |         | | | |               |         |                 | | | |         | |   |   |     |     | |         | | |       | |
         | +-|---|-------------------------------------+             | |   |         | | | |               |         +-------------------|---|-----------|---|---|-----|-------|-----------|-|-------+ |
         |   |   |   |     | |     |           |   |                 | |   |         | | | |               |                           | | | |         | |   |   |     |     | |         | | |         |
     +---|-----+ |   |     | |     |           |   |                 | |   |         | | | |               |                           +-|-------------|-|---|---+     +-----+ |         | | |         |
     |   |   | | |   |     | |     |           |   |                 | |   |         | | | |               |                             | | |         | |   |                 |         | | |         |
     |   |   | | |   |     | |     |           |   |                 | |   |         | | | | +-------------|---------+                   | | |         | |   |                 |         | | |         |
     |   |   | | |   |     | |     |           |   |                 | |   |         | | | | |             |         |                   | | |         | |   |                 |         | | |         |
     |   |   | | |   |     | |   +-----------------|-------------------+   |         | | | | |             |         +-------------------|-------------|-|---------------------|---------+ | |         |
     |   |   | | |   |     | |   | |           |   |                 |     |         | | | | |             |                             | | |         | |   |                 |           | |         |
     |   |   | | |   |     | |   | |           +---|-----------------|-----|-----------|-|-|-+             |                             | | |         | |   |                 |           | |         |
     |   |   | | |   |     | |   | |               |                 |     |         | | | |               |                             | | |         | |   |                 |           | |         |
     |   |   | | |   |     | |   | |               |                 |     |         +---------------------------------------------------+ | |         | | +-|-----------------|-----------|-|---------+
     |   |   | | |   |     | |   | |               |                 |     |           | | |               |                               | |         | | | |                 |           | |
     |   |   | | |   |     | |   | |               |                 |     |           | | |           +---|-------------------------------|-|---------|-|---------------------+           | |   +-+
     |   |   | | |   |     | |   | |               |                 |     |           | | |           |   |                               | |         | | | |                             | |   | |
 +---|---|-------+   |     | |   | +---------------------------------|-----|-----------+ | |           |   |                               +-----------|-|---------------------------------|-+   | |
 |   |   |   | |     |     | |   |                 |                 |     |             | |           |   |                                 |         | | | |                             |     | |
 |   |   |   +-+     |     +-|---|-----------------|-----------------------------------------------------------------------------------------------------|---|-----------------------------+     | |
 |   |   |           |       |   |                 |                 |     |             | |           |   |                                 |         | | | |                                   | |
 +---+   |           |       |   |                 |                 +-------------------|-----------------|-------------------------------------------|---+ +-------------------------------------+
         |           |       |   |                 |                       |             | |           |   |                                 |         | |                                       |
 +---+   |   +-------|-------|---|-+               |                       |             | +---------------|---------------------------------|---------|-|-----------------------------------+   |
 |   |   |   |       |       |   | |               |                       |             |             |   |                                 |         | |                                   |   |
 +---|---------------|-------|---|-----------------|-----------------------|-------------|-------------|---|---------------------------------|---------+ |                                   |   |
     |   |   |       |       |   | |               |                       |             |             |   |                                 |           |                                   |   |
     |   |   |       |       |   +-----+           |                       |             |             +---|-+                               +-----------+                                   |   |
     |   |   |       |       |     |   |           |                       |             |                 | |                                                                               |   |
     +---|---+       +-------+     +---+           |                       +-------------|-----------------+ +---------------------------------------------------+                           +---+
         |                                         |                                     |                                                                       |
         +-----------------------------------------+                                     +-----------------------------------------------------------------------+';

$lines = explode("\n", $input);

$y = 0;

$grid = [];

$steps = 0;

foreach ($lines as $line) {
    $chars = str_split($line);

    $x = 0;
    foreach ($chars as $char) {
        $grid[$y][$x] = $char;

        $x++;
    }
    $y++;
}

$pos = ['x' => 0, 'y' => 0];

$direction = null;

function move($pos, $direction, $test = false) {
    global $steps;

    switch ($direction) {
        case 'down':
            $pos['y']++;
            break;
        case 'up':
            $pos['y']--;
            break;
        case 'left':
            $pos['x']--;
            break;
        case 'right':
            $pos['x']++;
            break;
    }

    if ($test !== true) {
        $steps++;
    }

    return $pos;
}

function handlePipe($pos, &$direction) {
    switch ($direction) {
        case 'up':
            $pos = move($pos, 'up');
            break;
        default:
            $direction = 'down';
        case 'down':
            $pos = move($pos, 'down');
            break;
        case 'left':
        case 'right':
            $pos = move($pos, $direction);
            break;
    }

    return $pos;
}

function handleDash($pos, $direction) {
    switch ($direction) {
        case 'left':
            $pos = move($pos, 'left');
            break;
        case 'right':
            $pos = move($pos, 'right');
            break;
        case 'up':
        case 'down':
            $pos = move($pos, $direction);
            break;
    }

    return $pos;
}

function handlePlus($pos, &$direction, $grid) {
    switch ($direction) {
        case 'down':
        case 'up':
            // look left and right
            $test = move($pos, 'left', true);
            if (isset($grid[$test['y']][$test['x']]) && $grid[$test['y']][$test['x']] !== ' ') {
                $pos = move($pos, 'left');
                $direction = 'left';
            } else {
                $pos = move($pos, 'right');
                $direction = 'right';
            }
            break;
        case 'left':
        case 'right':
            // look up and down
            $test = move($pos, 'down', true);
            if (isset($grid[$test['y']][$test['x']]) && $grid[$test['y']][$test['x']] !== ' ') {
                $pos = move($pos, 'down');
                $direction = 'down';
            } else {
                $pos = move($pos, 'up');
                $direction = 'up';
            }
            break;
    }

    return $pos;
}

while (true) {
    if ($char === ' ' && $direction !== null) {
        break;
    }

    $char = $grid[$pos['y']][$pos['x']];

    switch ($char) {
        case '|':
            $pos = handlePipe($pos, $direction);
            break;
        case ' ':
            // this should only happen when directon = null
            if ($direction === null) {
                $pos['x']++;
            }
            break;
        case '+':
            $pos = handlePlus($pos, $direction, $grid);
            break;
        case '-':
            $pos = handleDash($pos, $direction);
            break;
        default:
            $letters[] = $char;
            $pos = move($pos, $direction);
            break;
    }
}

print $steps . PHP_EOL;
